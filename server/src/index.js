require("dotenv").config();
const express = require("express");
const { Telegraf } = require("telegraf");

const app = express();
const PORT = process.env.PORT || 3000;

// âœ… Ð§Ð¸Ñ‚Ð°ÐµÐ¼ Ñ‚Ð¾ÐºÐµÐ½ Ð¸Ð· .env
const bot = new Telegraf(process.env.BOT_TOKEN);

// ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð±Ð¾Ñ‚Ð°
bot.start((ctx) => ctx.reply("Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² AcademyCG! ðŸš€"));
bot.command("courses", (ctx) => {
  ctx.reply("ðŸ“š Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:\n1. ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ\n2. Ð”Ð¸Ð·Ð°Ð¹Ð½\n3. ÐœÐ°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³");
});

// Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
(async () => {
  try {
    await bot.launch();
    console.log("âœ… Telegram Ð±Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!");
  } catch (err) {
    console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°:", err);
  }
})();

// Express-Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ°
app.get("/", (req, res) => {
  res.send("AcademyCG Bot Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚! ðŸš€");
});

app.listen(PORT, () => console.log(`ðŸŒ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ ${PORT}`));

// ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ
process.once("SIGINT", () => bot.stop("SIGINT"));
process.once("SIGTERM", () => bot.stop("SIGTERM"));
